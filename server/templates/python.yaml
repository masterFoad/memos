# Python Template Configuration
template:
  name: "python"
  description: "Python development environment with GCP integration"
  image: "python:3.11-slim"
  
  # Container configuration
  container:
    working_dir: "/work"
    user: "root"
    environment:
      - PYTHONPATH=/work
      - PYTHONUNBUFFERED=1
    
    # Mount points
    mounts:
      - source: "/tmp/onmemos/work"
        target: "/work"
        type: "bind"
        options: "rw"
      
      - source: "/tmp/onmemos/tmp"
        target: "/tmp"
        type: "bind"
        options: "rw"
      
      - source: "/tmp/onmemos/persist"
        target: "/persist"
        type: "bind"
        options: "rw"
    
    # Ports
    ports:
      - "8080:8080"
    
    # Capabilities for GCS mounting
    privileged: true
    capabilities:
      - "SYS_ADMIN"
    
    # Devices
    devices:
      - "/dev/fuse:/dev/fuse"
    
    # Startup command
    command: |
      sh -c "
      # Install required packages
      apt-get update && apt-get install -y \
        gcsfuse \
        fuse \
        curl \
        wget \
        git \
        vim \
        nano \
        htop \
        tree \
        && rm -rf /var/lib/apt/lists/*
      
      # Create mount points
      mkdir -p /buckets /persist /work /tmp
      
      # Set up Python environment
      pip install --upgrade pip
      pip install google-cloud-storage google-cloud-compute
      
      # Start interactive shell
      exec /bin/bash
      "
